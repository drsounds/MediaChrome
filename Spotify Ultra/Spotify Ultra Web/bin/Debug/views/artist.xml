<?
/***
Artist view for SpotifyUltra



http://www.spotifyultra.com

*/

// Lookup artist on Spotify's server

var artistdata = synchronize_data("http://ws.spotify.com/lookup/1/?uri=spotify:artist:"+parameter.replace("spotify:artist:",""));
var title = "";
var releases = "";
if(!(!artistdata)){


/** Get basic values */
title = artistdata.GetElementsByTagName("name").Item(0).InnerText;

/** Lookup releases by the artist  */
var _releases = synchronize_data("http://ws.spotify.com/search/1/album?q=artist:\""+title.Replace(" ","%23")+"\"");
releases = _releases.GetElementsByTagName("album");

}

/** Get Local Content */
var localAlbums = queryLocalFiles("SELECT DISTINCT album FROM song WHERE artist='"+title+"'");

/** Get biography from Last.FM */
var bio = "No biography";



?>
<view>
	<toolbar>
	<!--	<item title="share" onclick="command()"/>
		<menu title="example">
			<menuitem onclick="test1()" title="A"/>
		</menu> -->
	</toolbar>
	<section name="Overview">
		
		<label size="20" left="310" top="@TOP" width="500" height="10"></label> 
		<img src="http://krakelin.com/artist.png" top="@TOP" left="10" width="120" height="120" persistent="true" />
<label size="20" left="310" top="@TOP" width="500" height="10" href="@{parameter}">@{title}</label> 	
		
	
		<space height="130"/>
		<?
	if(localAlbums.Count > 0){
	?>
	
	<section  width="-1" height="24" left="0" top="@TOP">Local Files</section>
	<space height="60"/>
% for(var i=0; i < localAlbums.Count; i++){ var localAlbum = localAlbums[i];
	<inflate src="components/local_album.xml" name="@{localAlbum.Album}" artist="@{title}"/>
% }

		<? } ?> 
		<section text="Albums" width="-1" left="0" height="24">Albums</section>
		<space height="10"/>

<?
for(var i=0; i < releases.Count ; i++){ 	
	var release = releases.Item(i);		
	var href = release.GetAttribute("href");		
	var name = release.GetElementsByTagName("name").Item(0).InnerText.replace("&","and").replace("'","");
	var artist = release.GetElementsByTagName("artist").Item(0).GetElementsByTagName("name").Item(0).InnerText.replace("&","and").replace("'","");;
?>
		<inflate src="components/album.xml" name="@{name}" artist="@{artist}" uri="@{href}"/>

% }
	
	
	</section>
	
</view>
		
